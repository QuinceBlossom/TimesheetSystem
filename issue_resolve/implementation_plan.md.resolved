# Tóm tắt Yêu cầu

1. **Quản lý trạng thái và Xác thực người dùng (Session/Auth)**:
   - Thêm cột `status` ('Active' | 'Blocked') vào bảng `users`.
   - Tất cả các request tới server (trừ Login) đều phải gửi kèn User ID (qua headers). Backend sử dụng User ID này để kiểm tra xem tài khoản có tồn tại và đang ở trạng thái `Active` hay không. Nếu `Blocked` hoặc không tồn tại, trả về 401/403.
   - Khi login: nếu trạng thái là `Blocked`, báo lỗi ngay lập tức, không cho phép lưu đăng nhập.
   - Frontend sẽ sử dụng Axios Interceptor để tự động đính kèm User ID vào request và đón lỗi 401/403 để xoá thông tin đăng nhập, hiển thị thông báo, bắt buộc đăng xuất (Force-logout).
2. **Quy tắc Admin trên Admin Dashboard**:
   - Admin không thể tự Khóa (Block) hoặc Xóa chính mình (kiểm tra so sánh ID bị tác động).
   - "Quy trình chuẩn": Muốn Xóa một nhân viên, Admin bắt buộc phải chuyển trạng thái nhân viên đó thành `Blocked` (Khóa) trước, sau đó mới được Xóa. 
   - Thêm tính năng thay đổi trạng thái Active/Blocked thẳng trên giao diện bảng cho thuận tiện.

## Đề xuất Thay đổi

### Cơ sở dữ liệu (Database)
- Thêm cột `status` VARCHAR(20) DEFAULT 'Active' vào bảng `users`.

### Backend ([backend/server.js](file:///d:/DoAnTotNghiep/backend/server.js))
#### [MODIFY] [server.js](file:///d:/DoAnTotNghiep/backend/server.js)
1. Thêm một Middleware chung sử dụng `app.use` (hoặc gắn vào API router) để kiểm tra header `x-user-id`. Nếu `userId` rỗng (bỏ qua nếu path là '/login'), hoặc user không tồn tại, hoặc `status === 'Blocked'`, trả về `{ status: 'fail', message: '...' }` kèm mã HTTP 401/403.
2. API **POST /login**: Kiểm tra thêm nếu user có `status === 'Blocked'` thì không trả về success.
3. API **PUT /users/update-status/:id**: API mới để Admin thay đổi trạng thái Active <-> Blocked của user. Nhận vào `status`. Kiểm tra ID bị tác động so với `req.headers['x-user-id']` để chặn thao tác tự khóa.
4. API **DELETE /users/delete/:id**: 
   - Kiểm tra chặn tự xóa chính mình.
   - Kiểm tra chỉ cho phép xóa những user đã có `status === 'Blocked'`.
   
### Frontend (`frontend/src/`)
#### [NEW] `frontend/src/axiosConfig.js` (hoặc nhúng vào App.jsx)
- Cấu hình Axios Request Interceptor: Lấy `timesheet_user` từ `localStorage`, luôn gắn header `x-user-id`.
- Cấu hình Axios Response Interceptor: Bắt mã status 401 hoặc 403, phát ra sự kiện `forceLogout`.

#### [MODIFY] [App.jsx](file:///d:/DoAnTotNghiep/frontend/src/App.jsx)
- Import cấu hình interceptor.
- Thêm `useEffect` lắng nghe sự kiện `forceLogout` để `setCurrentUser(null)` và đẩy ra thông báo "Phiên đăng nhập hết hạn hoặc tài khoản đã bị khóa."

#### [MODIFY] [Login.jsx](file:///d:/DoAnTotNghiep/frontend/src/components/Login.jsx)
- Hiển thị đúng câu báo lỗi khi Backend báo tài khoản Blocked.

#### [MODIFY] [AdminDashboard.jsx](file:///d:/DoAnTotNghiep/frontend/src/components/AdminDashboard.jsx)
- Bảng Grid: 
  - Thêm cột `Trạng thái` hiển thị badge `Active` / `Blocked`.
  - Cột Hành động: Thêm nút Khóa / Mở Khóa.
  - Gắn điều kiện: Nút Xóa chỉ hiện hoặc enabled nếu user đã bị Blocked. Khi nhấn Xóa hay Khóa chính mình thì chặn ngay trên UI (disable nút).

## Kiểm chứng
1. Đăng nhập Admin, tìm nhân viên A, thử ấn Xóa. Hệ thống sẽ chặn và yêu cầu Khóa trước.
2. Ấn Khóa nhân viên A, sau đó dùng trình duyệt khác đăng nhập nhân viên A, hệ thống sẽ báo tài khoản bị khóa.
3. Nếu nhân viên A đang đăng nhập trên trình duyệt 2, Admin nhấn Khóa A. Lần tiếp theo nhân viên A load trang hoặc bấm nạp việc, hệ thống tự đá văng ra Login.
4. Admin tự Xóa hoặc tự Khóa mình -> Hệ thống ẩn nút hoặc Backend chặn lỗi.
